Quero transformar este projeto Node.js + Express em uma vers√£o segura para produ√ß√£o no Replit (URL p√∫blica).

Objetivo: aplicar hardening b√°sico e remover vulnerabilidades cr√≠ticas.

Fa√ßa as seguintes altera√ß√µes no projeto:

1Ô∏è‚É£ REMOVER ADMIN PADR√ÉO FIXO

Remover qualquer cria√ß√£o autom√°tica do usu√°rio:
admin@3f.local

senha123

Criar admin SOMENTE se existirem as vari√°veis de ambiente:

ADMIN_EMAIL
ADMIN_PASSWORD

Se n√£o existirem, N√ÉO criar admin automaticamente.

Garantir que a senha seja sempre armazenada com bcrypt hash.

2Ô∏è‚É£ CONFIGURAR SESSION SEGURA PARA PRODU√á√ÉO

Modificar express-session para:

secret vindo de process.env.SESSION_SECRET

resave: false

saveUninitialized: false

cookie:
httpOnly: true
secure: true (porque Replit usa HTTPS)
sameSite: "lax"

Se SESSION_SECRET n√£o existir, lan√ßar erro e impedir o servidor de iniciar.

3Ô∏è‚É£ ADICIONAR RATE LIMIT NO LOGIN

Instalar e configurar express-rate-limit.

Criar rate-limit espec√≠fico para /api/login:

m√°ximo 5 tentativas por IP

janela de 15 minutos

retornar mensagem clara de bloqueio

Aplicar rate-limit somente na rota de login.

4Ô∏è‚É£ PROTEGER ROTA /admin

A rota GET /admin deve exigir:

requireAuth

requireAdmin

Se n√£o for admin autenticado ‚Üí retornar 403.

5Ô∏è‚É£ ADICIONAR HELMET

Instalar e configurar helmet com configura√ß√£o padr√£o segura.

6Ô∏è‚É£ CORS RESTRITO

Permitir CORS apenas para o dom√≠nio atual do Replit.

N√£o usar origin "*".

7Ô∏è‚É£ ADICIONAR CSRF PROTECTION

Instalar csurf e:

Aplicar CSRF token em todas as rotas POST, PUT, DELETE.

Enviar token via endpoint GET /api/csrf-token

Esperar token no header:
x-csrf-token

8Ô∏è‚É£ LOGAR TENTATIVAS DE LOGIN FALHAS

Quando login falhar:

registrar IP

registrar email tentado

registrar timestamp

9Ô∏è‚É£ INSTALAR DEPEND√äNCIAS NECESS√ÅRIAS

Instalar automaticamente:

helmet

express-rate-limit

csurf

cors

No final:

Me mostrar o novo server.js completo atualizado.

Me mostrar a lista de vari√°veis de ambiente que devo configurar no Replit Secrets.

N√£o remover funcionalidades existentes do sistema.

Manter compatibilidade com o frontend atual.

üöÄ Depois disso

No Replit voc√™ vai criar os Secrets:

SESSION_SECRET

ADMIN_EMAIL

ADMIN_PASSWORD

NODE_ENV = production

üéØ Observa√ß√£o importante (estrat√©gia)

Voc√™ est√° construindo o backbone do seu sistema interno (invent√°rio/produ√ß√£o da 3F).
Se esse backend cair ou for comprometido, voc√™ perde:

dados

hist√≥rico

logs

confian√ßa operacional

Ent√£o isso aqui n√£o √© ‚Äúexcesso de zelo‚Äù ‚Äî √© infraestrutura m√≠nima para empresa.